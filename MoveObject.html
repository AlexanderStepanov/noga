<!DOCTYPE html>
<html>

<head>
    <script type="text/javascript" src="scripts/jquery-2.0.3.min.js"></script>
    <script type="text/javascript">
        var _shipX = 0;
        var _shipY = 0;
        var _oldShipX = 0;
        var _oldShipY = 0;
        var _nextPoint = new Object();
        var _isMoving = false;
        var _delay = 0;

        var _moveQueue = new Array();

        $(document).ready(function() {
            startMoving();
        });

        function startMoving() {
            moveTo(500, 0);
            moveTo(500, 500);
            moveTo(0, 500);
            moveTo(0, 0);
            moveTo(200, 500);
        }

        function moveTo(x, y){
            var point = new Object();
            point.x = x;
            point.y = y;
            _moveQueue.push(point);
            moveNext();
        }

        function moveNext(){
            if(_isMoving || _moveQueue.length == 0) return;

            _nextPoint = dequeue();
            var differenceBetweenXs = Math.abs(_nextPoint.x - _shipX);
            var differenceBetweenYs = Math.abs(_nextPoint.y - _shipY);
            var allIterations = differenceBetweenXs > differenceBetweenYs ?
                    differenceBetweenXs : differenceBetweenYs;
            var oneIterationXStep = differenceBetweenXs / allIterations;
            var oneIterationYStep = differenceBetweenYs / allIterations;
            var iterations = 0;
            savePreviousValues();

            _delay = 0;
            while(iterations != allIterations){
                iterations++;
                _delay += 3;

                setTimeout(function(){
                    MoveToNextPoint(oneIterationXStep, oneIterationYStep);
                }, _delay);
            }
        }

        function MoveToNextPoint(oneIterationXStep, oneIterationYStep){
            _shipX = makeCloser(_shipX, _nextPoint.x, oneIterationXStep);
            _shipY = makeCloser(_shipY, _nextPoint.y, oneIterationYStep);

            setCoordinates(_shipX, _shipY);

            if(isMovedToEnd())
            {
                finishMove();
            }
        }

        function isMovedToEnd(){
            return _shipX == _nextPoint.x && _shipY == _nextPoint.y;
        }

        function finishMove(){
            _isMoving = false;
            moveNext();
        }

        function dequeue(){
            _isMoving = true;
            var result = _moveQueue[0];
            _moveQueue.splice(0, 1);

            return result;
        }

        function savePreviousValues(){
            _oldShipX = _shipX;
            _oldShipY = _shipY;
        }

        function makeCloser(current, mustBe, closerValue){
            return current >= mustBe? current - closerValue : current + closerValue;
        }

        function setCoordinates(x, y){
            $('#myDiv').css("left", x);
            $('#myDiv').css("top", y);
        }
    </script>
</head>
    <body>
        <!--<canvas id="myCanvas" width="288" height="288" />-->
        <img src="img/labyrinth.png" />
        <div id="myDiv" style="width: 30px; height: 30px; background-color: black; position: absolute;"></div>
    </body>
</html>
